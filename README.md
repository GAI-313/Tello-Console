# Tello-Console v.6.2.0
## 紹介
　Tello-Console は、本家 Tello SDK の Tello.py を参考に、作者なりに初心者でも安心してドローンのプログラミングを楽しめるよう最適化された Tello SDK です。
　この SDK では、全てのドローンオペレーションを1つのクラスとしてまとめられており、ドローンとの接続、コマンドの送信、データの送受信（ビデオデータを除く）が全て1つのモジュールとして完結します。（ビデオデータは OpenCV を事前にインポートする必要があります。）
　今後このパッケージが教育で活用され、新たなドローン開発者、プログラマーとして一歩進むでペロッパーたちをサポートできることを嬉しく思います。
## 対応機種
　Tello-Console は、DJI、RyzeTech が提供する Tello シリーズのみに対応しています。しかし、機種によって機能に制限がかかります。全ての機能をフルに使いたい方、教育用途で使用してい方は Tello-EDU を強くお勧めします。

- Tello EDU : Python、Swift、Scratch、ROS に対応。TelloSDK コマンド全てをサポート
  ![Tello-EDU](https://i.imgur.com/FOmxWPy.jpg)
- Tello : Tello-SDK の一部コマンドは対応していません。その代わり Tello EDU より低価格です。
  ![Tello](https://i.imgur.com/mzbhhYb.jpg)
- RobomasterTT : 日本未発売。外部端子を搭載しており、Tello EDU より汎用性が高いと思われます。
 ![RobomasterTT](https://i.imgur.com/KTs7YN3.png)
 
## 環境構築
　Tello console では、python3 をベースに記述されており、使用するPCに Python3 がインストールされていることが前提です。このセクションでは、各0S に分けて環境構築の方法を記述します。

### Windows
1. git をインストールしてください。 Windows で git をインストールして git を使用するには[こちらのサイト](https://prog-8.com/docs/git-env-win)を参考にしてセットアップを行なってください。
2. 以下のコマンドを実行して任意のディレクトリに Tello-Console をインストールします。
   ```bash
   git clone git@github.com:GAI-313/Tello-Console.git
   ```
3. その他必要なライブラリをインストールします。
   ```bash
   pip install opencv-python
   ```

### macOS
1. 以下のコマンドを実行して任意のディレクトリに Tello-Console をインストールします。
   ```bash
   git clone git@github.com:GAI-313/Tello-Console.git
   ```
2. その他必要なライブラリをインストールします。
   ```bash
   pip install opencv-python
   ```

### Ubuntu 20.04
　Ubuntu を使用している方は、あらかじめ Ubuntu 20.04 ~ にアップデートすることを推奨します。このパッケージは Python3 で動くことを前提としています。

1. 以下のコマンドで git をインストールします。
   ```bash
   sudo apt-get install git
   ```
2. 以下のコマンドを実行して任意のディレクトリに Tello-Console をインストールします。
   ```bash
   git clone git@github.com:GAI-313/Tello-Console.git
   ```
3. その他必要なライブラリをインストールします。
   ```bash
   pip install opencv-python
   ```

## tello-console を使う
　Tello-Console は、modules ディレクトリにある tello.py がメインプログラムとなり、基本的にはこのモジュールさえあれば TelloSDK が利用可能になります。そのため、Tello-Console から modules ディレクトリを抜き取ってそのまま使用できます。
　tello.py には、conosle クラスが格納されており、利用の際は console をインポートしてインスタンス化させてください。

```python
from modules.tello import console # console をインポート

drone = console() # conosle をインスタンス化

drone.takeoff() # 各メソッドの使用
```

## サンプルコードを使って学習する
　Tello-Console には標準でサンプルコードがいくつか用意されています。サンプルコードは、アップデートにつれて順次増やす予定です。サンプルコードでは Tello-Console の基本的な使い方を学ぶことができるので、ぜひご活用ください。サンプルコードには、以下が用意されています。

- sample_boot.py : Tello-Cosole の起動方法の基礎を解説したサンプルコードです。
- sample_flight_1.py : Tello を離着陸させるサンプルコードです。
- sample_flight_2.py : Tello を飛行させるのに必要な簡易的なコマンドをまとめたサンプルコードです。
- sample_get_data_1.py : Tello からドローンの各種データを取得する方法をまとめたサンプルコードです。
- sample_video_1.py : Tello からのカメラデータを取得、出力する方法をまとめたサンプルコードです。
- sample_video_.py : Tello からのカメラデータを取得、出力し、キーボードでドローンを操作する方法をまとめたサンプルコードです。


## コントロールメソッド
　tello.py クラス内には、**コントロールメソッド**、**設定メソッド**、**ステータスメソッド**、が用意されています。これら3つのメソッドは実行スクリプト内に挿入することができ、これらを使用することでドローンの操作が可能となります。以下のリストは利用可能なメソッドとその解説です。

|メソッド名|引数|引数ステータス|このメソッドについて|
|:---:|:---|:---|:---|
|takeoff()|なし|なし|ドローンを離陸させます。<br>このコマンドを実行することでドローンはその場から 1.2m 上昇し。その場でホバリングします。|
|land()|なし|なし|ドローンを着陸させます。<br>このコマンドを実行するとドローンはその場に自動着陸します。|
|stop()|なし|なし|ドローンを停止させます。<br>このコマンドを実行すると、ドローンはその場で停止。ホバリングします。<br>例えばドローンが移動している間にこのコマンドを実行することで、強制的にホバリングさせることができます。|
|emergency()|なし|なし|ドローンのモーターを停止させます。<br>ドローンが飛行中の場合、このコマンドを実行させることでドローンのモーターが停止して墜落します。stop() コマンドと同じく移動中でも優先されて実行されます。<br>　緊急時に使用することを推奨します。またこのコマンドを実行することでドローンが破損する恐れがあります。|
|wait()|sec|sec = int or float|ドローンを引数 sec 秒間待機させます。|
|speed()|cm|cm = int (20 ~ 100)|ドローンを引数 cm /s のスピードで飛行するように設定します。この設定をした後 rc コマンド以外の動作系コマンドの飛行スピードに影響します。デフォルトは 100m/s です。|
|forward()|cm|cm = int(20 ~ 500)|ドローンを引数 cm cm 前進させます。|
|back()|cm|cm = int(20 ~ 500)|ドローンを引数 cm cm 後進させます。|
|right()|cm|cm = int(20 ~ 500)|ドローンを引数 cm cm 右移動させます。|
|left()|cm|cm = int(20 ~ 500)|ドローンを引数 cm cm 左移動させます。|
|up()|cm|cm = int(20 ~ 500)|ドローンを引数 cm cm 上昇させます。|
|down()|cm|cm = int(20 ~ 500)|ドローンを引数 cm cm 下降させます。|
|cw()|dig|dig = int(10 ~ 500)|ドローンを引数 dig 度右旋回（時計回り）させます。|
|ccw()|dig|dig = int(10 ~ 500)|ドローンを引数 dig 度左旋回（反時計回り）させます。|
|flip()|dir|dir = str("f","b","l","r")|ドローンを引数 dir の方向に沿って機体を宙返りさせます。機体バッテリー残量が50％以下だとこのコマンドは使用できません。<br>dir = "f"：前方にフリップ<br>dir = "b"：後方にフリップ<br>dir = "l"：右方向にフリップ<br>dir = "r"：左方向にフリップ|
|go()|第1引数：x<br>第2引数：y<br>第3引数：z<br>第4引数：s<br>|x = int(-500 ~ -20 20 ~ 500)<br>y = int(-500 ~ -20 20 ~ 500)<br>z = int(-500 ~ -20 20 ~ 500)<br>s = int(20 ~ 100)<br>|ドローンを任意の位置へ飛行させます。<br>第1引数 x：ドローンを x cm 前後移動します。負の値だと後進します。<br>第2引数 y：ドローンを y cm 左右移動します。負の値だと右移動します。<br>第3引数 z：ドローンを z cm 上下移動します。負の値だと下降します。<br>第4引数 s：ドローンを s cm/s 飛行速度を設定します。|
|rc()|第1引数：elron<br>第2引数：elevator<br>第3引数：srotol<br>第4引数：laddor<br>|全ての引数 = int(-100 ~ 100)|ドローンの各舵の出力を行います。コントロールスティックからの出力と同等なので、複雑なオペレーションが可能です。<<br>　各引数は以下のように対応しています。<br>第1引数 elron = 左右移動 負の値だと左に移動します<br>第2引数 elevator = 前後移動 負の値だと後進します<br>第3引数 srotol = 上下移動 負の値だと下降します<br>第1引数 laddor = 旋回 負の値だと左旋回します|
|motor_start()|なし|なし|ドローンをその場でモーター起動させます。rc コマンドによるオペレートに応用する際に便利です。<br>**飛行中にこのコマンドは実行しないでください。**|
|downvision()|dir|dir = int(0 or 1)|カメラデータ取得位置を変更します。<br>引数 dir が1の場合、カメラデータ取得先は下方ビジョンセンサー（VPS）となります。<br>引数 dir が0の場合、カメラデータ取得先は前方のメインカメラからとなります。|
|stream()|video|video = int(0 or 1)|ドローンからのカメラデータ取得を管理します。現在このコマンドは試作段階です。<br>引数 video が0の場合、ドローンからのカメラデータ取得を終了します。<br>引数 video が1の場合、ドローンからのカメラデータの取得を開始します。|

## ステータスメソッド
　これらのメソッドは、ドローンのステータスを取得するメソッドとなります。これらのデータを取得することで、ドローンの状態に応じたスクリプトを記述できます。

|メソッド名|取得ステータス|取得ステータスの状態|メソッドの説明|
|:---:|:---|:---|:---|
|get_flighttime()|飛行時間|int (s)|ドローンの総飛行時間を取得します。|
|get_tof()|ToFセンサー|int (mm)|ドローン下部に搭載された ToF センサーから、現在の絶対飛行高度を取得します。|
|get_height|IMU、気圧センサー|int (cm)|ドローンの IMU から現在の相対高度を取得します。|v
|get_battery()|ドローンのバッテリー|int (%)|ドローンのバッテリー残量を取得します。|
|get_imu()|ドローンの姿勢角 pitch roll yaw をリストとして取得|all int [pitch, roll, yaw]|ドローンの各軸の姿勢角をリストとして取得。|

## 設定メソッド
　以下のメソッドは、ドローンに任意の設定を行うメソッドです。状況に応じた設定を行うことで、環境に応じたタスクを行うことができます。

|メソッド名|引数|引数ステータス|メソッドの説明|
|:---:|:---|:---|:---|
|ask_cmd()|cmd|cmd = str(tello command)|タイムアウト時に実行される任意コマンドを設定します。# Tello-Console

## リリースノート
### v.6.2.0
このバージョンでは、Windows 向けに最適化された修正を含みます。

- Windows のコマンドプロンプト上でテキストカラーが反映されない問題を修正。
- Windows 向けのチュートリアルを新たに作成。他OSチュートリアルを最適化。
- README のサンプルコード開設を分離。他サイトで公開予定。

### v.6.1.0
このバージョンでは、ステータスメソッドの修正を含みます。

- get_imu の imu データを整数型のリストとして取得できるようになりました。
- README の一部修正を行いまいした。

### v.6.0.1
このバージョンでは、本パッケージを教育目的での活用に最適化されたアップデートを含み、本家 tello.py の機能を十分に発揮しつつ初心者でも安心して実行できる豊富な関数（メソッド）を提供します。（更新日：2022/11/21）

- ドローンの飛行時間を取得する get_flighttime メソッドを追加しました。
- Tello-Console 内のステータス表示がデフォルトで日本語に対応しました。console クラスのインスタンス時の引数で英語に変更可能です。
- ステータスメッセージの非表示仕様を改良しました。
- console 内で発生したエラーの原因とヒントを表示するようにしました。

# 課題
 Windows 環境でドローンからのカメラビューの遅延が大きすぎる。WSL による検証を実行中。